<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Browser Toolbox</title>
<style>
  :root{--bg:#f6f7fb;--card:#fff;--muted:#666}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0;background:var(--bg);color:#111}
  header{background:#0b5cff;color:#fff;padding:16px 20px;display:flex;align-items:center;gap:12px}
  header h1{font-size:18px;margin:0}
  main{max-width:1100px;margin:20px auto;padding:0 16px}
  .top-actions{display:flex;gap:8px;align-items:center}
  .grid{display:grid;grid-template-columns:1fr 380px;gap:16px}
  .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(10,10,20,0.06)}
  nav{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}
  .tab{padding:8px 10px;border-radius:8px;background:transparent;border:1px solid transparent;cursor:pointer}
  .tab.active{background:#eef4ff;border-color:#cfe0ff}
  section{margin-top:12px}
  label{font-size:13px;color:var(--muted)}
  input[type="text"], textarea, select, pre { width:100%; box-sizing:border-box; padding:8px; border-radius:8px; border:1px solid #e6e6ef; font-family:inherit }
  textarea{min-height:120px;resize:vertical}
  button{padding:8px 10px;border-radius:8px;border:1px solid #cfd8ff;background:#f7faff;cursor:pointer}
  .row{display:flex;gap:8px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:.4rem .5rem;border-bottom:1px solid #f1f3f8;font-size:13px}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:12px;color:var(--muted)}
  .split{display:flex;gap:10px}
  .half{flex:1}
  .pill{padding:4px 8px;border-radius:999px;background:#eef3ff;border:1px solid #d6e3ff;font-size:13px}
  footer{max-width:1100px;margin:18px auto;color:var(--muted);font-size:13px}
  pre.output{background:#0f1724;color:#e6eef8;padding:10px;border-radius:8px;overflow:auto}
</style>
</head>
<body>
<header>
  <svg width="28" height="28" viewBox="0 0 24 24" fill="none" style="opacity:.95"><rect x="2" y="2" width="20" height="20" rx="4" fill="#fff" /><path d="M5 12h14M12 5v14" stroke="#0b5cff" stroke-width="1.5" stroke-linecap="round"/></svg>
  <h1>Browser Toolbox</h1>
  <div style="margin-left:auto" class="small">Safe · Same-origin only · No server</div>
</header>

<main>
  <nav id="tabs" class="card">
    <button class="tab active" data-tab="diagnostics">Diagnostics</button>
    <button class="tab" data-tab="storage">Storage</button>
    <button class="tab" data-tab="cache">Cache & SW</button>
    <button class="tab" data-tab="cookies">Cookies</button>
    <button class="tab" data-tab="json">JSON Formatter</button>
    <button class="tab" data-tab="text">Text Tools</button>
    <button class="tab" data-tab="colors">Color & Ruler</button>
  </nav>

  <div class="grid">
    <!-- Left column: tools -->
    <div>
      <!-- Diagnostics -->
      <section id="diagnostics" class="card">
        <h3>Diagnostics</h3>
        <div class="small muted">What the browser exposes for this page / origin</div>
        <div style="margin-top:12px" class="row">
          <button id="refreshDiag">Refresh</button>
          <button id="exportDiag">Export JSON</button>
          <div style="margin-left:auto" class="pill" id="uaText"></div>
        </div>
        <div style="margin-top:12px">
          <h4 style="margin:6px 0 8px 0">Memory</h4>
          <div id="memBlock" class="small muted">Checking...</div>

          <h4 style="margin:6px 0 8px 0">Storage estimate</h4>
          <div id="storageBlock" class="small muted">Checking...</div>

          <h4 style="margin:6px 0 8px 0">Network</h4>
          <div id="netBlock" class="small muted">Checking...</div>

          <h4 style="margin:6px 0 8px 0">Recent resources</h4>
          <div id="resBlock" class="small muted">Waiting for resource events...</div>
        </div>
      </section>

      <!-- Storage -->
      <section id="storage" class="card" style="display:none; margin-top:12px;">
        <h3>Storage editors</h3>
        <div class="muted">View & edit <code>localStorage</code> and <code>sessionStorage</code>. Be careful — edits are immediate.</div>
        <div style="margin-top:10px" class="split">
          <div class="half">
            <h4>localStorage</h4>
            <div id="lsList" style="max-height:220px;overflow:auto" class="small muted">Loading…</div>
            <div style="margin-top:8px">
              <input id="lsKey" placeholder="key" />
              <input id="lsVal" placeholder="value" />
              <button id="lsSet">Set</button>
              <button id="lsDel">Delete</button>
            </div>
            <div style="margin-top:6px"><button id="lsExport">Export CSV</button> <button id="lsClear">Clear all</button></div>
          </div>
          <div class="half">
            <h4>sessionStorage</h4>
            <div id="ssList" style="max-height:220px;overflow:auto" class="small muted">Loading…</div>
            <div style="margin-top:8px">
              <input id="ssKey" placeholder="key" />
              <input id="ssVal" placeholder="value" />
              <button id="ssSet">Set</button>
              <button id="ssDel">Delete</button>
            </div>
            <div style="margin-top:6px"><button id="ssClear">Clear all</button></div>
          </div>
        </div>

        <hr />
        <div>
          <h4>IndexedDB (basic)</h4>
          <div class="muted small">Lists databases and shows object store counts (read-only overview).</div>
          <button id="scanIdb">Scan IndexedDB</button>
          <pre id="idbOut" class="small" style="max-height:200px;overflow:auto"></pre>
        </div>
      </section>

      <!-- Cache & SW -->
      <section id="cache" class="card" style="display:none; margin-top:12px;">
        <h3>Cache & Service Worker</h3>
        <div class="small muted">Inspect Caches for this origin, and get service worker status.</div>
        <div style="margin-top:10px">
          <button id="refreshCaches">Refresh</button>
          <button id="clearCaches">Delete all caches</button>
          <button id="unregisterSW">Unregister SW (if any)</button>
        </div>
        <div id="cachesList" style="margin-top:10px;max-height:300px;overflow:auto" class="small muted">Loading…</div>
      </section>

      <!-- Cookies -->
      <section id="cookies" class="card" style="display:none; margin-top:12px;">
        <h3>Cookies</h3>
        <div class="small muted">View and set cookies for current origin/path.</div>
        <div style="margin-top:8px">
          <button id="refreshCookies">Refresh</button>
          <div id="cookieList" class="small muted" style="max-height:180px;overflow:auto"></div>
          <div style="margin-top:8px">
            <input id="cookieName" placeholder="name" />
            <input id="cookieValue" placeholder="value" />
            <input id="cookieExpires" placeholder="Expires (days, optional)" style="width:160px" />
            <button id="cookieSet">Set cookie</button>
            <button id="cookieDel">Delete cookie</button>
          </div>
        </div>
      </section>

      <!-- JSON Formatter -->
      <section id="json" class="card" style="display:none; margin-top:12px;">
        <h3>JSON Formatter / Validator</h3>
        <div class="small muted">Paste JSON and format / validate it.</div>
        <textarea id="jsonIn" placeholder='{"hello": "world"}'></textarea>
        <div style="margin-top:8px" class="row">
          <button id="fmtJson">Format</button>
          <button id="minJson">Minify</button>
          <button id="validateJson">Validate</button>
          <div style="margin-left:auto" class="small muted">Parsed output:</div>
        </div>
        <pre id="jsonOut" class="output" style="margin-top:8px;max-height:260px;overflow:auto"></pre>
      </section>

      <!-- Text Tools -->
      <section id="text" class="card" style="display:none; margin-top:12px;">
        <h3>Text Tools</h3>
        <div class="muted small">Clipboard tester, counters, and a quick password generator.</div>
        <div style="margin-top:8px">
          <textarea id="textIn" placeholder="Type/paste text here..."></textarea>
          <div style="margin-top:8px" class="row">
            <button id="copyBtn">Copy to clipboard</button>
            <button id="pasteBtn">Paste from clipboard</button>
            <button id="countBtn">Count words/chars</button>
            <button id="pwBtn">Generate password</button>
            <div style="margin-left:auto" id="counts" class="small muted"></div>
          </div>
        </div>
      </section>

      <!-- Colors & Ruler -->
      <section id="colors" class="card" style="display:none; margin-top:12px;">
        <h3>Color picker & Ruler</h3>
        <div class="muted small">Pick a color, get hex/rgb, sample screen color (limited), and measure viewport.</div>
        <div style="margin-top:8px" class="row">
          <input id="color" type="color" value="#0b5cff" style="width:64px;height:40px;padding:0;border-radius:8px;border:none" />
          <input id="colorHex" type="text" value="#0b5cff" />
          <button id="sampleColor">Sample (from page)</button>
        </div>
        <div style="margin-top:10px">
          <button id="viewportBtn">Show viewport size</button>
          <div id="viewportOut" class="small muted" style="margin-top:8px"></div>
        </div>
      </section>
    </div>

    <!-- Right column: logs / quick info -->
    <aside>
      <div class="card">
        <h4>Quick info</h4>
        <div class="small muted">Origin</div>
        <div id="origin" style="word-break:break-word"></div>
        <div style="margin-top:8px" class="small muted">User agent</div>
        <pre id="ua" class="small" style="background:#f4f6fb;padding:8px;border-radius:6px"></pre>
      </div>

      <div class="card" style="margin-top:12px;">
        <h4>Logs</h4>
        <pre id="log" class="small" style="max-height:360px;overflow:auto"></pre>
        <div style="margin-top:8px" class="row">
          <button id="clearLog">Clear</button>
          <button id="downloadLog">Download</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <h4>Shortcuts</h4>
        <ul class="small muted">
          <li>Use <code>Export JSON</code> in Diagnostics to save snapshot.</li>
          <li>Cache & SW only show same-origin entries.</li>
          <li>IndexedDB scanner is read-only overview.</li>
        </ul>
      </div>
    </aside>
  </div>
</main>

<footer>
  Built for diagnostics & dev convenience. This page only reads/manipulates data on this origin. Use responsibly.
</footer>

<script>
/* ----------------------
   Util & UI: tabs, log
   ----------------------*/
const tabs = document.querySelectorAll('.tab');
tabs.forEach(t => t.addEventListener('click', () => {
  tabs.forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  document.querySelectorAll('section').forEach(s => s.style.display='none');
  document.getElementById(t.dataset.tab).style.display = 'block';
}));

const logEl = document.getElementById('log');
function log(msg){
  const ts = new Date().toLocaleTimeString();
  logEl.textContent = `[${ts}] ${msg}\n` + logEl.textContent;
}

/* -----------------------------------
   Diagnostics: memory, storage, net
   -----------------------------------*/
document.getElementById('uaText').textContent = navigator.userAgent;
document.getElementById('origin').textContent = location.origin;
document.getElementById('ua').textContent = navigator.userAgent;

async function updateDiagnostics(){
  // memory (non-standard)
  const memBlock = document.getElementById('memBlock');
  if (performance && performance.memory){
    const m = performance.memory;
    memBlock.innerHTML = `Used ${(m.usedJSHeapSize/1024/1024).toFixed(2)} MB — Total ${(m.totalJSHeapSize/1024/1024).toFixed(2)} MB — Limit ${(m.jsHeapSizeLimit/1024/1024).toFixed(2)} MB`;
  } else memBlock.textContent = 'performance.memory not available (Chromium-only, usually)';

  // storage
  const sBlock = document.getElementById('storageBlock');
  if (navigator.storage && navigator.storage.estimate){
    try{
      const est = await navigator.storage.estimate();
      sBlock.textContent = `Usage: ${(est.usage/1024/1024||0).toFixed(2)} MB — Quota: ${(est.quota/1024/1024||0).toFixed(2)} MB`;
    } catch(e){
      sBlock.textContent = 'Storage estimate failed';
    }
  } else sBlock.textContent = 'Storage API not available';

  // network
  const netBlock = document.getElementById('netBlock');
  const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
  if (conn){
    netBlock.innerHTML = `Type: ${conn.effectiveType} — Downlink: ${conn.downlink} Mbps — RTT: ${conn.rtt} ms — saveData: ${conn.saveData}`;
  }else netBlock.textContent = 'Network Information API not supported';

  // resources: show last few resource timings
  try{
    const entries = performance.getEntriesByType ? performance.getEntriesByType('resource') : [];
    const last = entries.slice(-8).map(e => `${e.name.replace(location.origin,'')} ▸ ${Math.round(e.duration)} ms ▸ ${e.transferSize||0} bytes`).join('\n');
    document.getElementById('resBlock').textContent = last || 'No recent resource entries (or not supported)';
  }catch(e){ document.getElementById('resBlock').textContent = 'Resource timing not available'; }
  log('Diagnostics updated');
}
document.getElementById('refreshDiag').addEventListener('click', updateDiagnostics);
document.getElementById('exportDiag').addEventListener('click', async ()=>{
  const snapshot = await gatherSnapshot();
  const s = JSON.stringify(snapshot, null, 2);
  const blob = new Blob([s],{type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = `diag-${new Date().toISOString().replace(/[:.]/g,'-')}.json`; document.body.appendChild(a); a.click(); a.remove();
  log('Exported diagnostics');
});

async function gatherSnapshot(){
  const mem = performance && performance.memory ? {
    used: performance.memory.usedJSHeapSize,
    total: performance.memory.totalJSHeapSize,
    limit: performance.memory.jsHeapSizeLimit
  } : null;
  const storage = navigator.storage && navigator.storage.estimate ? await navigator.storage.estimate().catch(e=>({error:String(e)})) : null;
  const conn = navigator.connection || null;
  let cachesSnapshot = null;
  if ('caches' in window) {
    try {
      const ks = await caches.keys();
      cachesSnapshot = {};
      for (const k of ks){
        const c = await caches.open(k);
        const reqs = await c.keys();
        cachesSnapshot[k] = reqs.map(r=>({url:r.url}));
      }
    } catch(e){ cachesSnapshot = {error: String(e)}; }
  }
  const perfEntries = performance.getEntriesByType ? performance.getEntriesByType('resource').slice(-200).map(e=>({name:e.name, duration:e.duration, size:e.transferSize})) : [];
  return {
    timestamp: new Date().toISOString(),
    origin: location.origin,
    userAgent: navigator.userAgent,
    memory: mem,
    storage,
    connection: conn ? {effectiveType: conn.effectiveType, downlink: conn.downlink, rtt: conn.rtt} : null,
    caches: cachesSnapshot,
    perf: perfEntries
  };
}

/* -----------------------------------
   localStorage & sessionStorage ops
   -----------------------------------*/
function renderStorage(){
  const lsList = document.getElementById('lsList');
  const ssList = document.getElementById('ssList');
  // localStorage
  if (localStorage.length === 0) lsList.textContent = '(localStorage empty)';
  else {
    const rows = [];
    for (let i=0;i<localStorage.length;i++){
      const k = localStorage.key(i);
      rows.push(`${k} => ${localStorage.getItem(k)}`);
    }
    lsList.innerHTML = '<pre class="small">' + rows.join('\n') + '</pre>';
  }
  // sessionStorage
  if (sessionStorage.length === 0) ssList.textContent = '(sessionStorage empty)';
  else {
    const rows = [];
    for (let i=0;i<sessionStorage.length;i++){
      const k = sessionStorage.key(i);
      rows.push(`${k} => ${sessionStorage.getItem(k)}`);
    }
    ssList.innerHTML = '<pre class="small">' + rows.join('\n') + '</pre>';
  }
}

document.getElementById('lsSet').addEventListener('click', ()=>{
  const k=document.getElementById('lsKey').value; const v=document.getElementById('lsVal').value;
  if(!k){alert('Key required');return}
  localStorage.setItem(k,v);
  renderStorage(); log(`localStorage set ${k}`);
});
document.getElementById('lsDel').addEventListener('click', ()=>{
  const k=document.getElementById('lsKey').value; if(!k){alert('Key required');return}
  localStorage.removeItem(k); renderStorage(); log(`localStorage removed ${k}`);
});
document.getElementById('lsClear').addEventListener('click', ()=>{ if(confirm('Clear localStorage?')){localStorage.clear(); renderStorage(); log('localStorage cleared')}});
document.getElementById('lsExport').addEventListener('click', ()=>{
  const rows = [['key','value']];
  for (let i=0;i<localStorage.length;i++){ const k=localStorage.key(i); rows.push([k, localStorage.getItem(k)])}
  const csv = rows.map(r=>r.map(c=>'"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download='localStorage.csv'; document.body.appendChild(a); a.click(); a.remove(); log('Exported localStorage');
});

document.getElementById('ssSet').addEventListener('click', ()=>{
  const k=document.getElementById('ssKey').value; const v=document.getElementById('ssVal').value;
  if(!k){alert('Key required');return}
  sessionStorage.setItem(k,v); renderStorage(); log(`sessionStorage set ${k}`);
});
document.getElementById('ssDel').addEventListener('click', ()=>{
  const k=document.getElementById('ssKey').value; if(!k){alert('Key required');return}
  sessionStorage.removeItem(k); renderStorage(); log(`sessionStorage removed ${k}`);
});
document.getElementById('ssClear').addEventListener('click', ()=>{ if(confirm('Clear sessionStorage?')){sessionStorage.clear(); renderStorage(); log('sessionStorage cleared')}});

/* IndexedDB basic scan */
document.getElementById('scanIdb').addEventListener('click', async ()=>{
  const out = document.getElementById('idbOut'); out.textContent='Scanning...';
  if (!indexedDB.databases) { out.textContent = 'indexedDB.databases() not supported in this browser (limited overview)'; return; }
  try {
    const dbs = await indexedDB.databases();
    const lines = [];
    for (const db of dbs) {
      lines.push(`Name: ${db.name} — Version: ${db.version}`);
      // Opening to list object stores (read-only overview)
      try {
        await new Promise((res,rej)=> {
          const req=indexedDB.open(db.name);
          req.onsuccess=()=>{ const idb=req.result; const stores = Array.from(idb.objectStoreNames); lines.push(`  stores: ${stores.join(',')}`); idb.close(); res(); }
          req.onerror=()=>{ res(); }
        });
      } catch(e){}
    }
    out.textContent = lines.join('\n') || '(no DBs found)';
  } catch(e){ out.textContent = 'Error: '+e }
});

/* -------------------------
   Cache & SW inspection
   -------------------------*/
async function renderCaches(){
  const el = document.getElementById('cachesList');
  if (!('caches' in window)) { el.textContent = 'Cache API not supported'; return; }
  try{
    const keys = await caches.keys();
    if (keys.length===0){ el.textContent = '(no caches)'; return; }
    const parts=[];
    for (const k of keys){
      const c = await caches.open(k);
      const reqs = await c.keys();
      parts.push(`${k} — ${reqs.length} entries`);
      parts.push(reqs.slice(0,50).map(r=>`  • ${r.url.replace(location.origin,'')}`).join('\n'));
      if (reqs.length>50) parts.push(`  ...and ${reqs.length-50} more`);
    }
    el.textContent = parts.join('\n');
  }catch(e){ el.textContent = 'Error reading caches: '+e }
}
document.getElementById('refreshCaches').addEventListener('click', ()=>{ renderCaches(); log('Caches refreshed')});
document.getElementById('clearCaches').addEventListener('click', async ()=>{
  if (!confirm('Delete all caches for this origin?')) return;
  try{ const keys=await caches.keys(); await Promise.all(keys.map(k=>caches.delete(k))); renderCaches(); log('Caches deleted') }catch(e){ log('Error deleting caches: '+e) }
});
document.getElementById('unregisterSW').addEventListener('click', async ()=>{
  if (!('serviceWorker' in navigator)) { alert('Service worker not supported'); return; }
  const regs = await navigator.serviceWorker.getRegistrations();
  if (!regs.length) { alert('No service worker registrations found'); return; }
  if (!confirm('Unregister all service workers for this origin?')) return;
  for (const r of regs) { await r.unregister(); }
  log('Service workers unregistered'); alert('Unregistered');
});

/* -----------------------------
   Cookies: read/set/delete
   -----------------------------*/
function renderCookies(){
  const raw = document.cookie || '(no cookies)';
  document.getElementById('cookieList').textContent = raw;
}
document.getElementById('refreshCookies').addEventListener('click', renderCookies);
document.getElementById('cookieSet').addEventListener('click', ()=>{
  const name = document.getElementById('cookieName').value;
  const value = document.getElementById('cookieValue').value;
  const days = Number(document.getElementById('cookieExpires').value) || 0;
  if (!name) { alert('Cookie name required'); return; }
  let cookie = `${encodeURIComponent(name)}=${encodeURIComponent(value)}; path=/`;
  if (days>0){ const d = new Date(Date.now()+days*24*60*60*1000); cookie += '; expires='+d.toUTCString(); }
  document.cookie = cookie;
  renderCookies(); log(`Cookie set: ${name}`);
});
document.getElementById('cookieDel').addEventListener('click', ()=>{
  const name = document.getElementById('cookieName').value;
  if (!name) { alert('Cookie name required'); return; }
  document.cookie = `${encodeURIComponent(name)}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT`;
  renderCookies(); log(`Cookie deleted: ${name}`);
});

/* -----------------------------
   JSON Formatter
   -----------------------------*/
document.getElementById('fmtJson').addEventListener('click', ()=>{
  const inText = document.getElementById('jsonIn').value;
  try{ const obj = JSON.parse(inText); document.getElementById('jsonOut').textContent = JSON.stringify(obj, null, 2); log('JSON formatted') }catch(e){ document.getElementById('jsonOut').textContent = 'Invalid JSON: '+e; log('JSON format error') }
});
document.getElementById('minJson').addEventListener('click', ()=>{
  try{ const obj=JSON.parse(document.getElementById('jsonIn').value); document.getElementById('jsonOut').textContent = JSON.stringify(obj); log('JSON minified') }catch(e){ document.getElementById('jsonOut').textContent='Invalid JSON: '+e; }
});
document.getElementById('validateJson').addEventListener('click', ()=>{
  try{ JSON.parse(document.getElementById('jsonIn').value); document.getElementById('jsonOut').textContent = 'Valid JSON ✓'; log('JSON valid') }catch(e){ document.getElementById('jsonOut').textContent = 'Invalid JSON: '+e; log('JSON invalid') }
});

/* -----------------------------
   Text tools & clipboard
   -----------------------------*/
document.getElementById('copyBtn').addEventListener('click', async ()=>{
  try{ await navigator.clipboard.writeText(document.getElementById('textIn').value); alert('Copied!'); log('Copied to clipboard') }catch(e){ alert('Clipboard write failed: '+e); }
});
document.getElementById('pasteBtn').addEventListener('click', async ()=>{
  try{ const text = await navigator.clipboard.readText(); document.getElementById('textIn').value = text; log('Pasted from clipboard') }catch(e){ alert('Clipboard read failed: '+e); }
});
document.getElementById('countBtn').addEventListener('click', ()=>{
  const v = document.getElementById('textIn').value || '';
  const chars = v.length;
  const words = v.trim() ? v.trim().split(/\s+/).length : 0;
  document.getElementById('counts').textContent = `${words} words — ${chars} chars`;
  log('Counted text');
});
document.getElementById('pwBtn').addEventListener('click', ()=>{
  const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=';
  let pw='';
  for(let i=0;i<16;i++){ pw += chars[Math.floor(Math.random()*chars.length)]; }
  document.getElementById('textIn').value = pw; log('Generated password');
});

/* -----------------------------
   Color picker & viewport
   -----------------------------*/
document.getElementById('color').addEventListener('input', (e)=>{ document.getElementById('colorHex').value = e.target.value; });
document.getElementById('colorHex').addEventListener('change', (e)=>{ const v = e.target.value; if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(v)) document.getElementById('color').value = v;});
document.getElementById('viewportBtn').addEventListener('click', ()=>{
  document.getElementById('viewportOut').textContent = `Viewport: ${window.innerWidth} × ${window.innerHeight} px — Device Pixel Ratio: ${window.devicePixelRatio}`;
  log('Viewport measured');
});
document.getElementById('sampleColor').addEventListener('click', ()=>{
  alert('Color sampling from the screen is not permitted by browsers for security. Use developer tools or pick a color from the page manually.');
  log('Sample color requested (not permitted by browser)');
});

/* -----------------------------
   Logs controls & init
   -----------------------------*/
document.getElementById('clearLog').addEventListener('click', ()=>logEl.textContent='');
document.getElementById('downloadLog').addEventListener('click', ()=>{
  const b=new Blob([logEl.textContent],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='toolbox-log.txt'; document.body.appendChild(a); a.click(); a.remove();
  log('Log downloaded');
});

/* -----------------------------
   Auto-run init
   -----------------------------*/
renderStorage(); renderCaches(); renderCookies(); updateDiagnostics();
setInterval(()=>{
  // live-refresh diagnostics every 5s
  updateDiagnostics();
},5000);

/* Accessibility: announce that page is loaded */
log('Browser Toolbox loaded — same-origin only. Use responsibly.');

</script>
</body>
</html>